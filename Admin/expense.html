<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Expense Tracker - Onyx Pharma</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root {
            --primary: #f85606; --bg: #eff0f5; --card: #ffffff;
            --text: #212121; --dim: #757575; --danger: #d32f2f;
        }
        * { margin:0; padding:0; box-sizing:border-box; font-family: sans-serif; }
        
        body { background: var(--bg); color: var(--text); padding: 10px; overflow-x: hidden; width: 100%; }
        .wrapper { width: 100%; max-width: 100%; overflow-x: hidden; }

        .dash-title { margin: 15px 0; border-left: 5px solid var(--primary); padding-left: 10px; }
        .dash-title h2 { font-size: 20px; font-weight: 800; }

        /* Summary Cards */
        .master-card {
            background: var(--card); border-radius: 15px; padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px;
            display: flex; flex-direction: column; gap: 15px;
        }
        .lifetime-section { text-align: center; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .lifetime-section .lbl { font-size: 10px; font-weight: 700; color: var(--dim); text-transform: uppercase; }
        .lifetime-section .val { font-size: 30px; font-weight: 900; color: var(--primary); display: block; }

        .metrics-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .m-item { background: #f9f9f9; padding: 10px; border-radius: 10px; border-left: 3px solid #ddd; }
        .m-item span { font-size: 9px; font-weight: 700; color: var(--dim); display: block; }
        .m-item b { font-size: 14px; display: block; margin-top: 2px; }
        .c-today { border-left-color: var(--danger); }

        /* Floating Button */
        .fab {
            position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px;
            background: var(--primary); color: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; box-shadow: 0 5px 15px rgba(248, 86, 6, 0.4);
            cursor: pointer; z-index: 999; border: none;
        }

        /* Popup / Modal */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: none; align-items: center;
            justify-content: center; z-index: 1000; padding: 20px;
        }
        .modal-content {
            background: white; width: 100%; max-width: 400px;
            border-radius: 20px; padding: 20px; position: relative;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .close-modal { position: absolute; top: 15px; right: 20px; font-size: 20px; color: var(--dim); cursor: pointer; }

        /* Form Controls */
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; font-size: 11px; font-weight: 700; margin-bottom: 5px; }
        .form-group input, .form-group select { 
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; outline: none;
        }
        .btn-save { 
            width: 100%; padding: 14px; background: var(--primary); color: #fff; border: none; 
            border-radius: 8px; font-weight: 700; cursor: pointer;
        }

        /* Transactions Table */
        .card { background: var(--card); padding: 15px; border-radius: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); }
        .table-box { width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch; }
        table { width: 100%; border-collapse: collapse; min-width: 350px; }
        th { text-align: left; padding: 10px; background: #f4f4f4; font-size: 11px; text-transform: uppercase; }
        td { padding: 12px 10px; border-bottom: 1px solid #eee; font-size: 13px; }
        .cat-tag { font-size: 9px; background: #eee; padding: 2px 5px; border-radius: 4px; font-weight: 700; }

        @media (min-width: 768px) {
            body { padding: 30px; }
            .master-card { flex-direction: row; align-items: center; justify-content: space-between; }
            .lifetime-section { border-bottom: none; border-right: 2px solid #eee; padding: 0 30px 0 0; text-align: left; }
            .metrics-grid { grid-template-columns: repeat(5, 1fr); flex: 1; padding-left: 20px; }
        }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="dash-title">
        <h2>Expense Analytics</h2>
        <p style="font-size: 12px; color: var(--dim);">Onyx Pharma Cloud Sync</p>
    </div>

    <div class="master-card">
        <div class="lifetime-section">
            <span class="lbl">Lifetime Expense</span>
            <span class="val" id="sum-life">৳0</span>
        </div>
        <div class="metrics-grid">
            <div class="m-item c-today"><span>Today</span><b id="sum-today">৳0</b></div>
            <div class="m-item"><span>This Month</span><b id="sum-month">৳0</b></div>
            <div class="m-item"><span>Last Month</span><b id="sum-last">৳0</b></div>
            <div class="m-item"><span>This Year</span><b id="sum-year">৳0</b></div>
            <div class="m-item"><span>Last Year</span><b id="sum-lastyear">৳0</b></div>
        </div>
    </div>

    <div class="card">
        <h3 style="margin-bottom: 15px; color: var(--primary);">Recent Transactions</h3>
        <div class="table-box">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Details</th>
                        <th>Amount</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="list-body"></tbody>
            </table>
        </div>
    </div>
</div>

<button class="fab" id="openModal"><i class="fa fa-plus"></i></button>

<div class="modal-overlay" id="modalOverlay">
    <div class="modal-content">
        <span class="close-modal" id="closeModal">&times;</span>
        <h3 style="margin-bottom: 20px; color: var(--primary);">Add New Expense</h3>
        
        <div class="form-group">
            <label>PURPOSE</label>
            <input type="text" id="e-title" placeholder="e.g. Rent">
        </div>
        <div class="form-group">
            <label>CATEGORY</label>
            <select id="e-cat">
                <option>Utility</option>
                <option>Salary</option>
                <option>Rent</option>
                <option>Other</option>
            </select>
        </div>
        <div class="form-group">
            <label>AMOUNT</label>
            <input type="number" id="e-amt" placeholder="0.00">
        </div>
        <div class="form-group">
            <label>DATE</label>
            <input type="date" id="e-date">
        </div>
        <button class="btn-save" id="saveBtn">Save Entry</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyD1mn9MR9hyZ36Ce1lnGyJYmL6AHopScTA",
        databaseURL: "https://social-media-5e6c8-default-rtdb.firebaseio.com",
        projectId: "social-media-5e6c8",
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Modal Logic
    const modal = document.getElementById('modalOverlay');
    document.getElementById('openModal').onclick = () => modal.style.display = 'flex';
    document.getElementById('closeModal').onclick = () => modal.style.display = 'none';
    window.onclick = (e) => { if(e.target == modal) modal.style.display = 'none'; }

    document.getElementById('e-date').valueAsDate = new Date();

    // Save Data
    document.getElementById('saveBtn').onclick = async () => {
        const title = document.getElementById('e-title').value;
        const cat = document.getElementById('e-cat').value;
        const amt = parseFloat(document.getElementById('e-amt').value);
        const date = document.getElementById('e-date').value;

        if(!title || !amt) return alert("Empty fields!");

        await set(push(ref(db, 'expenses')), {
            title, category: cat, amount: amt, date,
            timestamp: new Date(date).getTime()
        });

        // Reset and Close
        document.getElementById('e-title').value = '';
        document.getElementById('e-amt').value = '';
        modal.style.display = 'none';
    };

    // Load Data
    onValue(ref(db, 'expenses'), (snap) => {
        const body = document.getElementById('list-body');
        body.innerHTML = '';
        const now = new Date();
        const tStr = now.toISOString().split('T')[0];
        const tM = now.getMonth(), tY = now.getFullYear();
        let life = 0, today = 0, month = 0, lastM = 0, year = 0, lastY = 0;
        const data = [];

        snap.forEach(c => {
            const e = c.val(); e.id = c.key; data.push(e);
            const a = parseFloat(e.amount);
            const d = new Date(e.date);
            const dM = d.getMonth(), dY = d.getFullYear();

            life += a;
            if(e.date === tStr) today += a;
            if(dM === tM && dY === tY) month += a;
            if(dM === (tM - 1) && dY === tY) lastM += a;
            if(dY === tY) year += a;
            if(dY === (tY - 1)) lastY += a;
        });

        document.getElementById('sum-life').innerText = "৳" + Math.round(life).toLocaleString();
        document.getElementById('sum-today').innerText = "৳" + Math.round(today).toLocaleString();
        document.getElementById('sum-month').innerText = "৳" + Math.round(month).toLocaleString();
        document.getElementById('sum-last').innerText = "৳" + Math.round(lastM).toLocaleString();
        document.getElementById('sum-year').innerText = "৳" + Math.round(year).toLocaleString();
        document.getElementById('sum-lastyear').innerText = "৳" + Math.round(lastY).toLocaleString();

        data.reverse().forEach(e => {
            body.innerHTML += `<tr>
                <td>${e.date.split('-').slice(1).join('-')}</td>
                <td><b>${e.title}</b><br><span class="cat-tag">${e.category}</span></td>
                <td style="color:red; font-weight:bold">৳${e.amount}</td>
                <td><i class="fa-solid fa-trash" style="color:#ccc" onclick="window.del('${e.id}')"></i></td>
            </tr>`;
        });
    });

    window.del = (id) => confirm("Delete?") && remove(ref(db, `expenses/${id}`));
</script>
</body>
</html>